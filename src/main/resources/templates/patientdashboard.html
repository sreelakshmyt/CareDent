<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Patient Dashboard - CareDent</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.3/css/bootstrap.min.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
      /* --- Minimalist & Clean Color Palette --- */
      :root {
          --caredent-primary: #005461; /* Dark Teal */
          --caredent-accent: #00B7B5; /* Bright Cyan for highlights */
          --caredent-neutral: #f8f9fa; /* Light Gray Background */
      }
      .bg-caredent-primary { background-color: var(--caredent-primary) !important; }
      .text-caredent-primary { color: var(--caredent-primary) !important; }
      .btn-caredent { background-color: var(--caredent-accent); border-color: var(--caredent-accent); color: #fff; }
      .btn-caredent:hover { background-color: #009997; border-color: #009997; }

      /* --- Minimalist Card Design (ATM Card Size) --- */
      .card-minimalist {
        border-radius: 10px;
        transition: box-shadow 0.2s;
        border: 1px solid #e9ecef;
        background: white;
        height: 100%;
        max-width: 380px; 
        min-height: 200px; 
      }
      .card-minimalist:hover {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      /* Specific colors for Plan Cards (Minimal use - border accent) */
      .card-basic { border-left: 5px solid #007bff; }
      .card-premium { border-left: 5px solid #dc3545; }
      .card-standard { border-left: 5px solid var(--caredent-primary); }

      /* --- Insurance Card Design (Active Plan) --- */
      .insurance-card-active {
        width: 100%;
        max-width: 420px; 
        height: 250px;
        color: white;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        padding: 20px;
      }
      
      /* Dynamic gradient color styles for ID cards */
      .id-card-basic { background: linear-gradient(135deg, #1976d2, #42a5f5); } /* Blue */
      .id-card-premium { background: linear-gradient(135deg, #d32f2f, #ef5350); } /* Red */
      .id-card-standard { background: linear-gradient(135deg, var(--caredent-primary), #018790); } /* Dark Teal/Primary */

      .insurance-card-active .card-header-title {
          font-size: 1.1rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.3);
          padding-bottom: 5px;
          margin-bottom: 10px;
      }
      .insurance-card-active strong { color: #fff; opacity: 0.9; }

      /* --- Interesting Content Section --- */
      .content-section {
          background-color: var(--caredent-neutral);
          padding: 3rem 0;
          margin-top: 3rem;
          border-top: 1px solid #e9ecef;
      }

      /* --- Header Welcome Message --- */
      .welcome-message {
          font-size: 1.5rem;
          font-weight: 500;
      }
      .header-content {
          padding: 1rem 0;
          text-align: center;
      }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-caredent-primary shadow py-3">
        <div class="container-fluid container">
            <a class="navbar-brand fw-bold fs-4" th:href="@{/}"><i class="fas fa-tooth me-2"></i>CareDent Portal</a>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle fs-6 text-white" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-th-large me-1"></i> Quick Access
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" th:href="@{/patient/dashboard}"><i class="fas fa-tachometer-alt me-2"></i>Dashboard Home</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/patient/claims}"><i class="fas fa-file-invoice me-2"></i>Submit/View Claims</a></li>
                            <li><a class="dropdown-item" th:href="@{/patient/benefits}"><i class="fas fa-chart-line me-2"></i>Benefit Usage</a></li>
                            <li><a class="dropdown-item" th:href="@{/patient/network}"><i class="fas fa-map-marker-alt me-2"></i>Find a Dentist</a></li>
                            <li><a class="dropdown-item" th:href="@{/patient/profile}"><i class="fas fa-user-circle me-2"></i>Manage Profile</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            
            <div class="d-flex align-items-center">
                <span class="navbar-text me-4 welcome-message text-white">
                    Welcome, <strong th:text="${patient != null ? patient.firstName : user.username}">User</strong>!
                </span>
                <a class="btn btn-outline-light" th:href="@{/logout}">
                    <i class="fas fa-sign-out-alt me-1"></i> Logout
                </a>
            </div>
        </div>
    </nav>
    
    <header class="header-content">
        <div class="container">
            <h2 class="fw-bold text-caredent-primary">Your Member Dashboard</h2>
            <p class="text-muted">Manage your plans, view benefits, and access your digital ID cards.</p>
        </div>
    </header>


    <main class="container my-5">
        
        <div th:if="${param.paid}" class="alert alert-success alert-dismissible fade show" role="alert">
            <strong>Enrollment Complete!</strong> Your coverage is now active.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <h3 class="mb-4 text-caredent-primary">Your Current Coverage (<span th:text="${activeEnrollments.size()}">0</span> Plans)</h3>
        
        <div th:if="${activeEnrollments.isEmpty()}" class="alert alert-warning text-center mb-5">
              You have no active plans. Scroll down to select a plan.
        </div>

        <div th:unless="${activeEnrollments.isEmpty()}" class="row mb-5">
            
             <div class="col-lg-6 mb-4 order-lg-2">
                <div class="card bg-light p-3 h-100">
                    <p class="fw-bold text-caredent-primary">Benefit Usage Summary:</p>
                    <p class="small mb-1">Annual Max Remaining: <strong>$XX.XX</strong></p>
                    <p class="small mb-1">Deductible Remaining: <strong>$XX.XX</strong></p>
                    <p class="small mt-3" th:if="${activeEnrollments.size() > 1}">
                        <i class="fas fa-info-circle me-1"></i> You have <span th:text="${activeEnrollments.size() - 1}"></span> other plan(s) active.
                    </p>
                </div>
            </div>


            <div class="col-lg-6 mb-4 order-lg-1">
                <div th:each="enrollment : ${activeEnrollments}" class="mb-4">
                    
                    <div th:classappend="${#strings.contains(enrollment.dentalPlan.name.toLowerCase(), 'basic') ? 'id-card-basic' : 
                                  (#strings.contains(enrollment.dentalPlan.name.toLowerCase(), 'premium') ? 'id-card-premium' : 'id-card-standard')}"
                          class="insurance-card-active">
                        
                        <div class="card-header-title fw-bold">Insurance Card</div>
                        
                        <h4 class="card-title fw-bolder mb-3" th:text="${enrollment.dentalPlan.name}"></h4>

                        <div class="row small mb-2">
                            <div class="col-6">Member: <strong th:text="${patient.firstName + ' ' + patient.lastName}"></strong></div>
                            <div class="col-6">ID: <strong th:text="'P' + ${patient.id} + 'E' + ${enrollment.id}"></strong></div>
                        </div>
                        <div class="row small mb-3">
                            <div class="col-6">Effective: <span th:text="${#temporals.format(enrollment.benefitYearStart, 'MM/dd/yyyy')}"></span></div>
                            <div class="col-6">Max: $<span th:text="${enrollment.dentalPlan.annualMax}"></span></div>
                        </div>
                        
                        <div class="d-flex justify-content-start">
                            <a th:href="@{/patient/card/download/{id}(id=${enrollment.id})}" 
                               class="btn btn-sm btn-light me-2 text-caredent-primary">
                                <i class="fas fa-file-pdf me-1"></i> Download PDF
                            </a>
                            
                            <a th:href="@{/patient/cancelForm/{id}(id=${enrollment.id})}" 
                               class="btn btn-sm btn-outline-light"
                               th:classappend="${enrollment.status != 'ACTIVE' ? 'disabled' : ''}">
                                <i class="fas fa-times-circle me-1"></i> Cancel Plan
                            </a>
                        </div>
                        
                        <div th:if="${enrollment.status == 'PENDING_CANCELLATION'}" class="mt-2 small fw-bold text-center bg-warning text-dark p-1 rounded">
                            <i class="fas fa-hourglass-half me-1"></i> Cancellation Pending Admin Review
                        </div>

                    </div>
                </div>
            </div>

        </div>
            
        <h3 class="mb-4 text-caredent-primary">Choose Your Plan</h3>
        
        <div class="row">
            <div class="col-md-4 mb-4" th:each="plan : ${plans}">
                <div th:with="planName=${plan.name.toLowerCase()}"
                    th:classappend="${#strings.contains(planName, 'basic')} ? 'card-basic' : 
                                    (${#strings.contains(planName, 'premium')} ? 'card-premium' : 'card-standard')"
                    class="card card-minimalist shadow-sm h-100 p-2">
                    
                    <div class="card-body">
                        <h5 class="card-title fw-bold text-caredent-primary" th:text="${plan.name}"></h5>
                        <p class="card-text mb-1 small">Deductible: $<span th:text="${plan.deductible}"></span></p>
                        <p class="card-text mb-1 small">Annual Max: $<span th:text="${plan.annualMax}"></span></p>
                        <p class="card-text mb-3 fw-bold">Premium: $<span th:text="${plan.premium}"></span>/month</p>
                        
                        <div th:if="${#lists.contains(activePlanIds, plan.id)}">
                            <button class="btn btn-warning w-100 fw-bold small" disabled>
                                Plan Already Enrolled
                            </button>
                        </div>
                        <div th:unless="${#lists.contains(activePlanIds, plan.id)}">
                            <a th:href="@{/patient/enrollForm/{id}(id=${plan.id})}" 
                               class="btn btn-caredent w-100 fw-bold small">
                                <i class="fas fa-plus me-1"></i> Start Enrollment
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <hr class="my-5">

        <h3 class="mb-4 text-caredent-primary">Quick Access & Resources</h3>
        <div class="row g-4 mb-5">
            <div class="col-md-3 col-sm-6">
                <a th:href="@{/patient/claims}" class="card text-center text-decoration-none card-minimalist shadow-sm p-3">
                    <div class="card-body p-0">
                        <i class="fas fa-file-invoice fa-2x text-caredent-primary mb-2"></i>
                        <h6 class="card-title text-dark small fw-bold">Submit/View Claims</h6>
                    </div>
                </a>
            </div>
            <div class="col-md-3 col-sm-6">
                <a th:href="@{/patient/benefits}" class="card text-center text-decoration-none card-minimalist shadow-sm p-3">
                    <div class="card-body p-0">
                        <i class="fas fa-chart-line fa-2x text-caredent-primary mb-2"></i>
                        <h6 class="card-title text-dark small fw-bold">Benefit Usage</h6>
                    </div>
                </a>
            </div>
            <div class="col-md-3 col-sm-6">
                <a th:href="@{/patient/network}" class="card text-center text-decoration-none card-minimalist shadow-sm p-3">
                    <div class="card-body p-0">
                        <i class="fas fa-map-marker-alt fa-2x text-caredent-primary mb-2"></i>
                        <h6 class="card-title text-dark small fw-bold">Find a Dentist</h6>
                    </div>
                </a>
            </div>
            <div class="col-md-3 col-sm-6">
                <a th:href="@{/patient/profile}" class="card text-center text-decoration-none card-minimalist shadow-sm p-3">
                    <div class="card-body p-0">
                        <i class="fas fa-user-circle fa-2x text-caredent-primary mb-2"></i>
                        <h6 class="card-title text-dark small fw-bold">Manage Profile</h6>
                    </div>
                </a>
            </div>
        </div>
        
        <hr class="my-5">

        <h3 class="mb-4 text-caredent-primary">Plan History</h3>
        
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm border-caredent">
                    <div class="card-header bg-caredent-primary text-white fw-bold">Current & Pending Plans Summary</div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center" th:each="enrollment : ${activeEnrollments}">
                            <span th:text="${enrollment.dentalPlan.name}">Plan Name</span>
                            <span class="badge" 
                                    th:classappend="${enrollment.status == 'ACTIVE' ? 'bg-success' : 'bg-warning text-dark'}" 
                                    th:text="${enrollment.status}">
                                    ACTIVE
                            </span>
                        </li>
                        <li th:if="${activeEnrollments.isEmpty()}" class="list-group-item text-muted">No current active plans.</li>
                    </ul>
                </div>
            </div>
            
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm border-caredent">
                    <div class="card-header bg-caredent-primary text-white fw-bold">Cancelled & Expired Plans History</div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center" th:each="enrollment : ${historyEnrollments}">
                            <span th:text="${enrollment.dentalPlan.name}">Plan Name</span>
                            <span class="badge bg-secondary" 
                                    th:text="${enrollment.status}">
                                    CANCELLED
                            </span>
                        </li>
                        <li th:if="${historyEnrollments.isEmpty()}" class="list-group-item text-muted">No past plans recorded.</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <hr class="my-5">


        <div class="content-section">
            <div class="row justify-content-center">
                <div class="col-md-10 text-center">
                    <h4 class="text-caredent-primary mb-3">Our Commitment: Advanced Dental Insurance</h4>
                    <p class="text-muted lead small">
                        CareDent is a role-based insurance management platform that simulates real U.S. dental insurance operations, providing comprehensive plan creation, claim processing, and network handling for a seamless experience.
                    </p>
                    <a href="#" class="btn btn-outline-secondary btn-sm">Learn More About Dental Benefits</a>
                </div>
            </div>
        </div>
        
    </main>

    <footer class="bg-caredent-primary text-white pt-4 pb-2 mt-0">
        <div class="container text-center">
            <small>&copy; 2025 CareDent Insurance System. All rights reserved.</small>
        </div>
    </footer>

    <script th:src="@{/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js}"></script>
</body>
</html>